<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Тренажер: Сокращения Premium Wide</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Montserrat:wght@400;500;600;700&display=swap');

        :root {
            --bg-silk: #fdfaf5;
            --gold-accent: #bc932f;
            --gold-gradient: linear-gradient(135deg, #d4af37, #bc932f);
            --gold-border: #d4af37;
            --text-dark: #2c2c2c;
            --success: #2e7d32;
            --success-bg: #e8f5e9;
            --error: #d32f2f;
            --error-bg: #ffebee;
        }

        body {
            font-family: 'Montserrat', sans-serif;
            background-color: var(--bg-silk);
            margin: 0; padding: 5px;
            display: flex; justify-content: center;
        }

        #matching-wide {
            background: #ffffff;
            border: 1px solid var(--gold-border);
            border-radius: 4px;
            padding: 15px 30px;
            width: 100%; 
            max-width: 1100px; /* Пошире по запросу */
            min-height: auto;
            box-shadow: 0 40px 90px rgba(188, 147, 47, 0.12);
            display: flex; flex-direction: column;
            position: relative; box-sizing: border-box;
        }

        header {
            text-align: center; margin-bottom: 10px;
            border-bottom: 1px solid rgba(188, 147, 47, 0.1); padding-bottom: 10px;
        }

        h2 { font-family: 'Playfair Display', serif; color: var(--gold-accent); font-size: 24px; margin: 0; text-transform: uppercase; }

        .matching-area {
            display: grid; 
            grid-template-columns: 1fr 150px 1fr; /* Пошире центральная часть для анимации линий */
            gap: 10px; 
            position: relative; 
            margin-top: 5px; 
            flex: 1;
        }

        .column { display: flex; flex-direction: column; gap: 6px; justify-content: center; z-index: 10; }

        .item {
            background: #fff; border: 1px solid #eee;
            border-radius: 6px; padding: 8px 15px;
            font-size: 14px; font-weight: 500; cursor: pointer;
            transition: all 0.2s ease;
            position: relative; display: flex; align-items: center; 
            justify-content: center; min-height: 38px; text-align: center;
        }

        .item:hover { border-color: var(--gold-accent); background: #fdfaf5; transform: translateY(-1px); }
        .item.active { border-color: var(--gold-accent); background: var(--gold-accent); color: white; }
        
        /* Подсветка */
        .item.correct { border: 2px solid var(--success) !important; background: var(--success-bg) !important; color: var(--success) !important; }
        .item.wrong { border: 2px solid var(--error) !important; background: var(--error-bg) !important; color: var(--error) !important; }

        .anchor {
            width: 8px; height: 8px; background: #ddd;
            border-radius: 50%; position: absolute; top: 50%; transform: translateY(-50%);
        }
        .anchor-right { right: -12px; }
        .anchor-left { left: -12px; }

        #svg-layer {
            position: absolute; top: 0; left: 0;
            width: 100%; height: 100%; pointer-events: none; z-index: 1;
        }

        .path-line {
            fill: none; stroke: var(--gold-accent); stroke-width: 2.5;
            stroke-linecap: round; pointer-events: auto; cursor: pointer;
            stroke-dasharray: 1000; stroke-dashoffset: 1000;
            animation: drawLine 0.7s ease-out forwards; /* Анимация прорисовки */
        }

        @keyframes drawLine { to { stroke-dashoffset: 0; } }

        .path-line:hover { stroke: var(--error); stroke-width: 4; }
        .path-correct { stroke: var(--success) !important; stroke-width: 3.5; }
        .path-wrong { stroke: var(--error) !important; stroke-width: 3.5; }

        .actions { text-align: center; margin-top: 20px; padding-bottom: 10px; }
        
        .btn-check {
            background: var(--gold-gradient); color: white;
            padding: 12px 60px; border: none; border-radius: 4px;
            font-size: 16px; font-weight: 700; text-transform: uppercase;
            cursor: pointer; box-shadow: 0 10px 20px rgba(188, 147, 47, 0.2);
            transition: 0.3s;
        }
        .btn-check:hover { transform: translateY(-2px); box-shadow: 0 15px 30px rgba(188, 147, 47, 0.3); }

        #status-bar { font-weight: 700; margin-top: 10px; font-size: 16px; text-align: center; min-height: 25px; }
    </style>
</head>
<body onresize="drawLines()">

<div id="matching-wide">
    </header>

    <div class="matching-area" id="area">
        <svg id="svg-layer"></svg>
        <div class="column" id="left-col"></div>
        <div></div> <div class="column" id="right-col"></div>
    </div>

    <div class="actions">
        <button class="btn-check" onclick="validate()">Проверить результат</button>
        <div id="status-bar"></div>
    </div>
</div>

<script>
    const dataset = [
        { id: 1, l: "ПЗ", r: "Пояснительная записка" },
        { id: 2, l: "ТК", r: "Технологическая карта" },
        { id: 3, l: "ПОС", r: "Проект организации строительства" },
        { id: 4, l: "ПБ", r: "Пожарная безопасность" },
        { id: 5, l: "ПД", r: "Проектная документация" },
        { id: 6, l: "РД", r: "Рабочая документация" },
        { id: 7, l: "ППР", r: "Проект производства работ" },
        { id: 8, l: "ОТ", r: "Охрана труда" }
    ];

    let selected = null;
    let connections = [];

    function init() {
        const lCol = document.getElementById('left-col');
        const rCol = document.getElementById('right-col');
        const sL = [...dataset].sort(() => Math.random() - 0.5);
        const sR = [...dataset].sort(() => Math.random() - 0.5);

        sL.forEach(d => {
            const div = document.createElement('div');
            div.className = 'item';
            div.innerHTML = `${d.l} <div class="anchor anchor-right"></div>`;
            div.dataset.id = d.id; div.dataset.side = 'l';
            div.onclick = () => handleSelect(div);
            lCol.appendChild(div);
        });

        sR.forEach(d => {
            const div = document.createElement('div');
            div.className = 'item';
            div.innerHTML = `<div class="anchor anchor-left"></div> ${d.r}`;
            div.dataset.id = d.id; div.dataset.side = 'r';
            div.onclick = () => handleSelect(div);
            rCol.appendChild(div);
        });
    }

    function handleSelect(el) {
        // Сброс подсветки при новом клике
        document.getElementById('status-bar').innerText = "";
        
        const linkIndex = connections.findIndex(c => c.l === el || c.r === el);
        if (linkIndex !== -1) {
            connections[linkIndex].l.classList.remove('active', 'correct', 'wrong');
            connections[linkIndex].r.classList.remove('active', 'correct', 'wrong');
            connections.splice(linkIndex, 1);
            drawLines();
            return;
        }

        if (!selected) {
            selected = el; el.classList.add('active');
        } else if (selected.dataset.side === el.dataset.side) {
            selected.classList.remove('active'); selected = el; el.classList.add('active');
        } else {
            const link = {
                l: selected.dataset.side === 'l' ? selected : el,
                r: selected.dataset.side === 'r' ? selected : el,
                idL: selected.dataset.side === 'l' ? selected.dataset.id : el.dataset.id,
                idR: selected.dataset.side === 'r' ? selected.dataset.id : el.dataset.id,
                validated: false
            };
            connections.push(link);
            selected.classList.remove('active');
            selected = null;
            drawLines();
        }
    }

    function drawLines() {
        const svg = document.getElementById('svg-layer');
        svg.innerHTML = '';
        const rect = document.getElementById('area').getBoundingClientRect();

        connections.forEach(c => {
            const lDot = c.l.querySelector('.anchor-right').getBoundingClientRect();
            const rDot = c.r.querySelector('.anchor-left').getBoundingClientRect();

            const x1 = lDot.left - rect.left + 4;
            const y1 = lDot.top - rect.top + 4;
            const x2 = rDot.left - rect.left + 4;
            const y2 = rDot.top - rect.top + 4;

            // Кривая Безье для красоты
            const cp1x = x1 + (x2 - x1) / 2;
            const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
            const d = `M ${x1} ${y1} C ${cp1x} ${y1}, ${cp1x} ${y2}, ${x2} ${y2}`;
            path.setAttribute("d", d);
            path.classList.add('path-line');
            if (c.validated) path.classList.add(c.idL === c.idR ? 'path-correct' : 'path-wrong');
            svg.appendChild(path);
        });
    }

    function validate() {
        if (connections.length === 0) return;
        let errors = 0;
        connections.forEach(c => {
            c.validated = true;
            const isOk = c.idL === c.idR;
            c.l.classList.remove('correct', 'wrong');
            c.r.classList.remove('correct', 'wrong');
            c.l.classList.add(isOk ? 'correct' : 'wrong');
            c.r.classList.add(isOk ? 'correct' : 'wrong');
            if (!isOk) errors++;
        });
        drawLines();
        
        const status = document.getElementById('status-bar');
        if (errors === 0 && connections.length === dataset.length) {
            status.innerText = "✅ Все сокращения сопоставлены верно!";
            status.style.color = "var(--success)";
        } else {
            status.innerText = `⚠️ Ошибок: ${errors}. Нажмите на неверные линии для исправления.`;
            status.style.color = "var(--error)";
        }
    }

    init();
</script>

</body>
</html>